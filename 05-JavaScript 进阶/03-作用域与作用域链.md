# 作用域与作用域链

1. 如何理解？
   * 作用域就相当于一块 "地盘", 一个代码段所在的区域
   * 它是静态的(相对于上下文对象来说，上下文对象是动态的), 在编写代码时就已经确定了
2. 作用域分类
   * 全局作用域
   * 函数作用域
   * 没有块作用域(ES6有了)
3. 作用域的作用
   * 隔离变量，不同作用域下同名变量不会有冲突

```js
var a = 10,
  b = 20
function fn(x) {
  var a = 100,
    c = 300;
  console.log('fn()', a, b, c, x) 
  function bar(x) {
    var a = 1000,
      d = 400
    console.log('bar()', a, b, c, d, x) // 1000 20 300 400 100
  }
  bar(100)
  bar(200)
}
fn(10)
// fn() 100 20 300 10
// bar() 1000 20 300 400 100
// bar() 1000 20 300 400 200
```

![20190420133500.png](http://img.fuwenwei.com/blog/20190420133500.png)

## 作用域与执行上下文的区别和练习

1. 区别 1
   * 全局作用域之外，每个函数都会创建自己的作用域，作用域在函数定义时就已经确定了，而不是在函数调用时确定的
   * 全局执行上下文环境是在全局作用域确定之后, js代码马上执行之前创建的
   * 函数执行上下文是在调用函数时, 函数体代码执行之前创建的
2. 区别 2
   * 作用域是静态的, 只要函数定义好了就一直存在, 且不会再变化
   * 执行上下文是动态的, 调用函数时创建, 函数调用结束时就会自动释放（不是垃圾回收）
3. 联系
   * 执行上下文(对象)是从属于所在的作用域
   * 全局上下文环境从属于全局作用域
   * 函数上下文环境从属于对应的函数使用域

![20190420133538.png](http://img.fuwenwei.com/blog/20190420133538.png)

## 作用域链

1. 理解作用域链
   * 多个上下级关系的作用域形成的链, 它的方向是从下向上的(从内到外)
   * 查找变量时就是沿着作用域链来查找的
2. 查找一个变量的查找规则
   * 在当前作用域下的执行上下文中查找对应的属性, 如果有直接返回, 否则进入上一级作用域
   * 在上一级作用域的执行上下文中查找对应的属性, 如果有直接返回, 否则进入上一级作用域
   * 继续在上一级作用域中执行相同操作, 直到全局作用域, 如果还找不到就抛出找不到的异常

```js
var a = 1
function fn1() {
  var b = 2
  function fn2() {
    var c = 3
    console.log(c)
    console.log(b)
    console.log(a)
    console.log(d)
  }
  fn2()
}
fn1()
```

![20190420134002.png](http://img.fuwenwei.com/blog/20190420134002.png)

## 作用域面试题

```js
var x = 10;
function fn() {
  console.log(x);
}
function show(f) {
  var x = 20;
  f();
}
show(fn); // 10
```

解释：为什么会输出 10？这个是根据作用域来判断的。这段代码中有全剧作用域，fn函数作用域，show函数作用域，在执行show函数时，再去执行 fn 函数，这时先在 fn 的函数作用域中找 x ，没找到，则往上一级查找，它的上一级是全局作用域，所以 x 为10，这里就是一句话 **作用域在函数定义时就已经存在了，不会再改变了，除非你修改代码**，fn 的上一级作用域从代码中看就是全局作用域，不要被迷糊了。

```js
var fn = function () {
  console.log(fn)
}
fn() // 输出 fn 这个函数

var obj = {
  fn2: function () {
    console.log(fn2) // 报错
    //console.log(this.fn2)
  }
}
obj.fn2()
```

![20190420135133.png](http://img.fuwenwei.com/blog/20190420135133.png)

解释：这里报错的原因也是查找上一级作用域，上一级作用域也就是全局作用域，fn2 没有定义所以报错，如果里面写成 `this.fn2` 则会在 obj 这个对象中找，打印出 fn2 不会报错。